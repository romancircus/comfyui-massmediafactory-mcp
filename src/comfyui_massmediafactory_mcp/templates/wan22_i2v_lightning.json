{
  "_meta": {
    "description": "WAN 2.2 I2V Lightning - 4-step distilled LoRA with dual high/low noise models for fast generation",
    "model": "Wan 2.2 I2V Lightning (Comfy-Org fp8 + LightX2V LoRA)",
    "type": "img2vid",
    "parameters": [
      "IMAGE_PATH",
      "PROMPT",
      "NEGATIVE",
      "SEED",
      "FRAMES",
      "FPS",
      "STEPS",
      "CFG",
      "SHIFT",
      "WIDTH",
      "HEIGHT",
      "NOISE_AUG",
      "SPLIT_STEP"
    ],
    "defaults": {
      "SEED": 42,
      "FRAMES": 81,
      "FPS": 16,
      "STEPS": 4,
      "CFG": 1.0,
      "SHIFT": 5.0,
      "WIDTH": 832,
      "HEIGHT": 480,
      "NOISE_AUG": 0.2,
      "SPLIT_STEP": 2,
      "PROMPT": "smooth motion, high quality video",
      "NEGATIVE": "static subject, frozen creature, camera movement, camera motion, panning, zooming, orbiting, dolly, static image, no motion, blurry, distorted, ugly, worst quality, low resolution, jerky motion, morphing, shape-shifting"
    },
    "vram_min": 24,
    "tags": [
      "model:wan",
      "quality:lightning",
      "priority:experimental",
      "repo:pokedex"
    ],
    "version": "1.0.0",
    "skip_hardware_optimization": true,
    "notes": "Two-pass Lightning architecture. CFG MUST be 1.0 \u2014 distilled LoRAs bake in guidance, CFG>1 causes blur/corruption. Uses flowmatch_distill scheduler (hardcoded timesteps [999,750,500,250] matching LoRA training). shift=5 + noise_aug=0.2 + CLIP preserves creature color/identity. SHIFT parameterized for tuning.",
    "hub_hash": "7b51a237d40e57b3"
  },
  "1": {
    "class_type": "WanVideoModelLoader",
    "_meta": {
      "title": "HIGH NOISE model"
    },
    "inputs": {
      "model": "wan22_lightning/split_files/diffusion_models/wan2.2_i2v_high_noise_14B_fp8_scaled.safetensors",
      "base_precision": "bf16",
      "quantization": "fp8_e4m3fn_scaled",
      "load_device": "offload_device",
      "attention_mode": "sdpa"
    }
  },
  "2": {
    "class_type": "WanVideoModelLoader",
    "_meta": {
      "title": "LOW NOISE model"
    },
    "inputs": {
      "model": "wan22_lightning/split_files/diffusion_models/wan2.2_i2v_low_noise_14B_fp8_scaled.safetensors",
      "base_precision": "bf16",
      "quantization": "fp8_e4m3fn_scaled",
      "load_device": "offload_device",
      "attention_mode": "sdpa"
    }
  },
  "3": {
    "class_type": "WanVideoVAELoader",
    "inputs": {
      "model_name": "wan_2.1_vae.safetensors",
      "precision": "bf16"
    }
  },
  "4": {
    "class_type": "CLIPVisionLoader",
    "_meta": {
      "title": "CLIP vision (identity preservation)"
    },
    "inputs": {
      "clip_name": "clip_vision_h.safetensors"
    }
  },
  "5": {
    "class_type": "LoadImage",
    "inputs": {
      "image": "{{IMAGE_PATH}}"
    }
  },
  "6": {
    "class_type": "WanVideoClipVisionEncode",
    "_meta": {
      "title": "CLIP encode (anchors creature colors)"
    },
    "inputs": {
      "clip_vision": [
        "4",
        0
      ],
      "image_1": [
        "5",
        0
      ],
      "strength_1": 1.0,
      "strength_2": 1.0,
      "crop": "center",
      "combine_embeds": "average",
      "force_offload": true
    }
  },
  "7": {
    "class_type": "WanVideoImageToVideoEncode",
    "inputs": {
      "width": "{{WIDTH}}",
      "height": "{{HEIGHT}}",
      "num_frames": "{{FRAMES}}",
      "noise_aug_strength": "{{NOISE_AUG}}",
      "start_latent_strength": 1.0,
      "end_latent_strength": 1.0,
      "force_offload": true,
      "vae": [
        "3",
        0
      ],
      "clip_embeds": [
        "6",
        0
      ],
      "start_image": [
        "5",
        0
      ]
    }
  },
  "8": {
    "class_type": "WanVideoTextEncodeCached",
    "_meta": {
      "title": "T5 encoder"
    },
    "inputs": {
      "model_name": "umt5_xxl_fp16.safetensors",
      "precision": "bf16",
      "positive_prompt": "{{PROMPT}}",
      "negative_prompt": "{{NEGATIVE}}",
      "quantization": "disabled",
      "use_disk_cache": true,
      "device": "gpu"
    }
  },
  "10": {
    "class_type": "WanVideoBlockSwap",
    "_meta": {
      "title": "Block swap (VRAM management for 32GB)"
    },
    "inputs": {
      "blocks_to_swap": 20,
      "offload_img_emb": false,
      "offload_txt_emb": false
    }
  },
  "11": {
    "class_type": "WanVideoSetBlockSwap",
    "_meta": {
      "title": "Apply block swap to HIGH NOISE"
    },
    "inputs": {
      "model": [
        "1",
        0
      ],
      "block_swap_args": [
        "10",
        0
      ]
    }
  },
  "12": {
    "class_type": "WanVideoSetBlockSwap",
    "_meta": {
      "title": "Apply block swap to LOW NOISE"
    },
    "inputs": {
      "model": [
        "2",
        0
      ],
      "block_swap_args": [
        "10",
        0
      ]
    }
  },
  "13": {
    "class_type": "WanVideoLoraSelect",
    "_meta": {
      "title": "HIGH NOISE LoRA"
    },
    "inputs": {
      "lora": "wan2.2_i2v_A14b_high_noise_lora_rank64_lightx2v_4step_1022.safetensors",
      "strength": 1.0,
      "merge_loras": false
    }
  },
  "14": {
    "class_type": "WanVideoLoraSelect",
    "_meta": {
      "title": "LOW NOISE LoRA"
    },
    "inputs": {
      "lora": "wan2.2_i2v_A14b_low_noise_lora_rank64_lightx2v_4step_1022.safetensors",
      "strength": 1.0,
      "merge_loras": false
    }
  },
  "15": {
    "class_type": "WanVideoSetLoRAs",
    "_meta": {
      "title": "Apply HIGH NOISE LoRA to model"
    },
    "inputs": {
      "model": [
        "11",
        0
      ],
      "lora": [
        "13",
        0
      ]
    }
  },
  "16": {
    "class_type": "WanVideoSetLoRAs",
    "_meta": {
      "title": "Apply LOW NOISE LoRA to model"
    },
    "inputs": {
      "model": [
        "12",
        0
      ],
      "lora": [
        "14",
        0
      ]
    }
  },
  "20": {
    "class_type": "WanVideoSampler",
    "_meta": {
      "title": "PASS 1: High noise (steps 0 to SPLIT_STEP)"
    },
    "inputs": {
      "model": [
        "15",
        0
      ],
      "image_embeds": [
        "7",
        0
      ],
      "text_embeds": [
        "8",
        0
      ],
      "steps": "{{STEPS}}",
      "cfg": "{{CFG}}",
      "shift": "{{SHIFT}}",
      "seed": "{{SEED}}",
      "force_offload": true,
      "scheduler": "flowmatch_distill",
      "riflex_freq_index": 0,
      "denoise_strength": 1.0,
      "rope_function": "comfy",
      "end_step": "{{SPLIT_STEP}}"
    }
  },
  "21": {
    "class_type": "WanVideoSampler",
    "_meta": {
      "title": "PASS 2: Low noise (steps SPLIT_STEP to end)"
    },
    "inputs": {
      "model": [
        "16",
        0
      ],
      "image_embeds": [
        "7",
        0
      ],
      "text_embeds": [
        "8",
        0
      ],
      "samples": [
        "20",
        0
      ],
      "steps": "{{STEPS}}",
      "cfg": "{{CFG}}",
      "shift": "{{SHIFT}}",
      "seed": "{{SEED}}",
      "force_offload": true,
      "scheduler": "flowmatch_distill",
      "riflex_freq_index": 0,
      "denoise_strength": 1.0,
      "rope_function": "comfy",
      "start_step": "{{SPLIT_STEP}}"
    }
  },
  "30": {
    "class_type": "WanVideoDecode",
    "inputs": {
      "vae": [
        "3",
        0
      ],
      "samples": [
        "21",
        0
      ],
      "enable_vae_tiling": false,
      "tile_x": 272,
      "tile_y": 272,
      "tile_stride_x": 144,
      "tile_stride_y": 128
    }
  },
  "31": {
    "class_type": "CreateVideo",
    "inputs": {
      "images": [
        "30",
        0
      ],
      "fps": "{{FPS}}"
    }
  },
  "32": {
    "class_type": "SaveVideo",
    "inputs": {
      "video": [
        "31",
        0
      ],
      "filename_prefix": "wan22_lightning",
      "format": "mp4",
      "codec": "h264"
    }
  }
}
