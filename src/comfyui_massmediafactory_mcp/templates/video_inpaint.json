{
  "_meta": {
    "description": "Video Inpainting - Edit specific elements within a video",
    "type": "video_edit",
    "use_case": "Edit/replace objects in video while maintaining temporal consistency (replaces Kling O1)",
    "replaces": "Kling O1 Video Editing",
    "parameters": ["VIDEO_PATH", "SELECT_TEXT", "REPLACE_PROMPT", "DENOISE", "SEED"],
    "defaults": {
      "DENOISE": 0.7,
      "SEED": 42
    },
    "agent_notes": {
      "VIDEO_PATH": "Path to video to edit",
      "SELECT_TEXT": "Text description of object to edit (e.g., 'the red car', 'person's shirt')",
      "REPLACE_PROMPT": "What the selected area should become",
      "DENOISE": "0.5-0.7 for object replacement, 0.3-0.5 for color/texture changes",
      "how_it_works": [
        "1. Extract frames from video",
        "2. Generate mask using CLIPSeg on first frame",
        "3. Propagate mask across all frames",
        "4. Inpaint each frame with temporal consistency",
        "5. Reconstruct video with original audio"
      ],
      "limitations": [
        "Best for static or slow-moving objects",
        "Fast motion may cause flickering",
        "Large objects work better than small details"
      ]
    },
    "custom_nodes_required": ["ComfyUI-VideoHelperSuite", "ComfyUI-segment-anything"],
    "vram_required_gb": 16
  },
  "1": {
    "class_type": "VHS_LoadVideo",
    "_comment": "Load source video",
    "inputs": {
      "video": "{{VIDEO_PATH}}",
      "force_rate": 24,
      "force_size": "Disabled",
      "frame_load_cap": 0,
      "skip_first_frames": 0
    }
  },
  "2": {
    "class_type": "VHS_SplitImages",
    "_comment": "Get first frame for mask generation",
    "inputs": {
      "images": ["1", 0],
      "split_index": 1
    }
  },
  "3": {
    "class_type": "CLIPSeg",
    "_comment": "Generate mask from text description on first frame",
    "inputs": {
      "image": ["2", 0],
      "text": "{{SELECT_TEXT}}",
      "blur": 7,
      "threshold": 0.4
    }
  },
  "4": {
    "class_type": "GrowMask",
    "_comment": "Expand mask for better blending",
    "inputs": {
      "mask": ["3", 0],
      "expand": 8,
      "tapered_corners": true
    }
  },
  "5": {
    "class_type": "PropagateMask",
    "_comment": "Propagate mask across all video frames",
    "inputs": {
      "images": ["1", 0],
      "mask": ["4", 0],
      "method": "optical_flow"
    }
  },
  "6": {
    "class_type": "UNETLoader",
    "inputs": {
      "unet_name": "flux2-dev-fp8.safetensors",
      "weight_dtype": "fp8_e4m3fn"
    }
  },
  "7": {
    "class_type": "DualCLIPLoader",
    "inputs": {
      "clip_name1": "clip_l.safetensors",
      "clip_name2": "t5xxl_fp16.safetensors",
      "type": "flux"
    }
  },
  "8": {
    "class_type": "VAELoader",
    "inputs": {
      "vae_name": "ae.safetensors"
    }
  },
  "9": {
    "class_type": "CLIPTextEncode",
    "inputs": {
      "clip": ["7", 0],
      "text": "{{REPLACE_PROMPT}}"
    }
  },
  "10": {
    "class_type": "FluxGuidance",
    "inputs": {
      "conditioning": ["9", 0],
      "guidance": 3.5
    }
  },
  "11": {
    "class_type": "VHS_BatchedVAEEncode",
    "_comment": "Encode all video frames to latent",
    "inputs": {
      "pixels": ["1", 0],
      "vae": ["8", 0],
      "mask": ["5", 0]
    }
  },
  "12": {
    "class_type": "KSamplerSelect",
    "inputs": {
      "sampler_name": "euler"
    }
  },
  "13": {
    "class_type": "BasicScheduler",
    "inputs": {
      "model": ["6", 0],
      "scheduler": "simple",
      "steps": 15,
      "denoise": "{{DENOISE}}"
    }
  },
  "14": {
    "class_type": "RandomNoise",
    "inputs": {
      "noise_seed": "{{SEED}}"
    }
  },
  "15": {
    "class_type": "BasicGuider",
    "inputs": {
      "model": ["6", 0],
      "conditioning": ["10", 0]
    }
  },
  "16": {
    "class_type": "VHS_BatchedSampler",
    "_comment": "Process all frames with temporal consistency",
    "inputs": {
      "noise": ["14", 0],
      "guider": ["15", 0],
      "sampler": ["12", 0],
      "sigmas": ["13", 0],
      "latent_image": ["11", 0],
      "temporal_consistency": 0.8
    }
  },
  "17": {
    "class_type": "VHS_BatchedVAEDecode",
    "_comment": "Decode all frames back to images",
    "inputs": {
      "samples": ["16", 0],
      "vae": ["8", 0]
    }
  },
  "18": {
    "class_type": "VHS_VideoCombine",
    "_comment": "Reconstruct video with original audio",
    "inputs": {
      "images": ["17", 0],
      "audio": ["1", 1],
      "frame_rate": 24,
      "filename_prefix": "video_inpaint",
      "format": "video/h264-mp4",
      "pingpong": false,
      "save_output": true
    }
  }
}
