{
  "_meta": {
    "description": "Video Inpainting - Edit specific elements within a video (Single Frame Reference)",
    "type": "video_edit",
    "use_case": "Edit/replace objects in video using first-frame mask propagation",
    "replaces": "Basic video masking workflows",
    "parameters": [
      "VIDEO_PATH",
      "SELECT_TEXT",
      "REPLACE_PROMPT",
      "DENOISE",
      "SEED"
    ],
    "defaults": {
      "DENOISE": 0.7,
      "SEED": 42
    },
    "agent_notes": {
      "VIDEO_PATH": "Path to video to edit",
      "SELECT_TEXT": "Text description of object to edit (e.g., 'the red car', 'person's shirt')",
      "REPLACE_PROMPT": "What the selected area should become",
      "DENOISE": "0.5-0.7 for object replacement, 0.3-0.5 for color/texture changes",
      "how_it_works": [
        "1. Extract frames from video",
        "2. Generate mask using CLIPSeg on first frame",
        "3. Apply same mask to all frames (static masking)",
        "4. Inpaint each frame independently",
        "5. Reconstruct video with original audio"
      ],
      "limitations": [
        "IMPORTANT: This template uses static masking - object must not move significantly",
        "For moving objects, use ProPainter or dedicated video inpainting models",
        "Best for: background replacement, static object removal",
        "Not suitable for: tracking moving objects, precise temporal consistency"
      ]
    },
    "custom_nodes_required": [
      "ComfyUI-VideoHelperSuite",
      "ComfyUI-CLIPSeg"
    ],
    "alternative_solutions": {
      "ProPainter": "Best for moving object removal with temporal consistency",
      "Kling O1": "Cloud API for complex video editing"
    },
    "vram_required_gb": 16,
    "status": "EXPERIMENTAL - Uses static mask, not true temporal propagation",
    "vram_min": 4,
    "tags": [
      "type:utility",
      "capability:inpaint"
    ]
  },
  "1": {
    "class_type": "VHS_LoadVideo",
    "_comment": "Load source video",
    "inputs": {
      "video": "{{VIDEO_PATH}}",
      "force_rate": 24,
      "force_size": "Disabled",
      "frame_load_cap": 0,
      "skip_first_frames": 0
    }
  },
  "2": {
    "class_type": "GetImageFromBatch",
    "_comment": "Get first frame for mask generation (node from ComfyUI-VideoHelperSuite or built-in)",
    "inputs": {
      "images": [
        "1",
        0
      ],
      "index": 0
    }
  },
  "3": {
    "class_type": "CLIPSeg",
    "_comment": "Generate mask from text description on first frame",
    "inputs": {
      "image": [
        "2",
        0
      ],
      "text": "{{SELECT_TEXT}}",
      "blur": 7,
      "threshold": 0.4
    }
  },
  "4": {
    "class_type": "GrowMask",
    "_comment": "Expand mask for better blending",
    "inputs": {
      "mask": [
        "3",
        0
      ],
      "expand": 8,
      "tapered_corners": true
    }
  },
  "5": {
    "class_type": "RepeatMaskBatch",
    "_comment": "Repeat the same mask for all video frames (static masking)",
    "inputs": {
      "mask": [
        "4",
        0
      ],
      "amount": 120
    }
  },
  "6": {
    "class_type": "UNETLoader",
    "inputs": {
      "unet_name": "flux2-dev-fp8.safetensors",
      "weight_dtype": "fp8_e4m3fn"
    }
  },
  "7": {
    "class_type": "DualCLIPLoader",
    "inputs": {
      "clip_name1": "clip_l.safetensors",
      "clip_name2": "t5xxl_fp16.safetensors",
      "type": "flux"
    }
  },
  "8": {
    "class_type": "VAELoader",
    "inputs": {
      "vae_name": "ae.safetensors"
    }
  },
  "9": {
    "class_type": "CLIPTextEncode",
    "inputs": {
      "clip": [
        "7",
        0
      ],
      "text": "{{REPLACE_PROMPT}}"
    }
  },
  "10": {
    "class_type": "FluxGuidance",
    "inputs": {
      "conditioning": [
        "9",
        0
      ],
      "guidance": 3.5
    }
  },
  "11": {
    "class_type": "VAEEncodeForInpaint",
    "_comment": "Encode video frames with mask for inpainting (supports batch)",
    "inputs": {
      "pixels": [
        "1",
        0
      ],
      "vae": [
        "8",
        0
      ],
      "mask": [
        "5",
        0
      ],
      "grow_mask_by": 6
    }
  },
  "12": {
    "class_type": "KSamplerSelect",
    "inputs": {
      "sampler_name": "euler"
    }
  },
  "13": {
    "class_type": "BasicScheduler",
    "inputs": {
      "model": [
        "6",
        0
      ],
      "scheduler": "simple",
      "steps": 15,
      "denoise": "{{DENOISE}}"
    }
  },
  "14": {
    "class_type": "RandomNoise",
    "inputs": {
      "noise_seed": "{{SEED}}"
    }
  },
  "15": {
    "class_type": "BasicGuider",
    "inputs": {
      "model": [
        "6",
        0
      ],
      "conditioning": [
        "10",
        0
      ]
    }
  },
  "16": {
    "class_type": "SamplerCustomAdvanced",
    "_comment": "Process all frames (batched latents, no temporal consistency)",
    "inputs": {
      "noise": [
        "14",
        0
      ],
      "guider": [
        "15",
        0
      ],
      "sampler": [
        "12",
        0
      ],
      "sigmas": [
        "13",
        0
      ],
      "latent_image": [
        "11",
        0
      ]
    }
  },
  "17": {
    "class_type": "VAEDecode",
    "_comment": "Decode all frames back to images (supports batch)",
    "inputs": {
      "samples": [
        "16",
        0
      ],
      "vae": [
        "8",
        0
      ]
    }
  },
  "18": {
    "class_type": "VHS_VideoCombine",
    "_comment": "Reconstruct video with original audio",
    "inputs": {
      "images": [
        "17",
        0
      ],
      "audio": [
        "1",
        2
      ],
      "frame_rate": 24,
      "loop_count": 0,
      "filename_prefix": "video_inpaint",
      "format": "video/h264-mp4",
      "pingpong": false,
      "save_output": true,
      "pix_fmt": "yuv420p",
      "crf": 19,
      "save_metadata": true
    }
  }
}